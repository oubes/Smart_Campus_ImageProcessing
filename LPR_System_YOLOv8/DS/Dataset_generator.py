# %% Get a list of all system fonts
# import matplotlib.font_manager, os
# system_fonts = matplotlib.font_manager.findSystemFonts(fontpaths=None, fontext='ttf')
# for font in system_fonts:
#     print(os.path.basename(font))

# %% define:
chars = {
    'أ': 'alf', 'ب': 'baa', 'ت': 'taa', 'ج': 'jeem',
    'د': 'daal', 'ر': 'raa', 'س': 'seen', 'ص': 'saad',
    'ف': 'faa', 'ق': 'qaaf', 'ل': 'laam', 'م': 'meem',
    'ن': 'noon', 'ه': 'haa', 'و': 'waw', 'ي': 'yaa',
    '١': '1', '٢': '2', '٣': '3', '٤': '4', '٥': '5',
    '٦': '6', '٧': '7', '٨': '8', '٩': '9', '٠': '0'
}
char_dirs = chars.values()
letters = chars.keys()

# %%
from keras.preprocessing.image import ImageDataGenerator
import cv2, os, shutil
from PIL import Image, ImageDraw, ImageFont 

def remake_dirs(main_dir):
    shutil.rmtree(main_dir, ignore_errors=True)
    for char_dir in char_dirs:
        os.makedirs(os.path.join(main_dir, char_dir), exist_ok=False)

def letters_gen(main_dir, img_name, letter_size, margin, font_name):
    for letter, dir in zip(letters, char_dirs):
        font = ImageFont.truetype(font_name, letter_size)
        img = Image.new('RGB', (letter_size+margin[1], letter_size+margin[0]), color = (255, 255, 255))
        draw = ImageDraw.Draw(img)
        text_width, text_height = draw.textsize(letter, font)

        x = (img.width - text_width) / 2
        y = (img.height - text_height) / 4

        draw.text((x, y), letter, fill=(0,0,0), font=font)
        img = img.convert('L') # Convert to grayscale
        img.save(f'{main_dir}/{dir}/{img_name}.png')

def multi_size_font_gen(main_dir, sizes, fonts, margin):
    for size in sizes:
        for font in fonts:
            letters_gen(
                main_dir = main_dir,
                img_name = f'img_size[{size}]_font[{font}]',
                letter_size = size,
                margin = margin,
                font_name= font
            )

def Dataset_Gen(main_dir, aug_imgs_num, sizes, fonts, margin):
    multi_size_font_gen(main_dir, sizes, fonts, margin)
    for letter_dir in os.listdir(main_dir):
        for img in os.listdir(os.path.join(main_dir, letter_dir)):
            imagegen = ImageDataGenerator(
                rotation_range=15,
                zoom_range=0.1,
                shear_range=0.15,
                width_shift_range=0.1,
                height_shift_range=0.1,
                horizontal_flip=False,
                vertical_flip=False,
                brightness_range=(0.5, 1.5),
                fill_mode='nearest',
                rescale=1./255,
                validation_split=0.2
            )

            image = cv2.imread(os.path.join(main_dir, letter_dir, img))
            image = image.reshape((1,) + image.shape)

            imagegen.fit(image)
            img_gen = imagegen.flow(
                image,
                batch_size=1,
                save_to_dir=os.path.join(main_dir, letter_dir),
                save_prefix="aug",
                save_format="png"
            )

            if aug_imgs_num != 0:
                for i, batch in enumerate(img_gen):
                    if i+1 >= aug_imgs_num:
                        break
# %%
main_dir = 'training_ds'
remake_dirs(main_dir)
Dataset_Gen(
    main_dir=main_dir,
    aug_imgs_num = 50,
    sizes = [50], # list of sizes
    fonts = ['majallab', 'segoeuib'], # list of fonts
    margin = [12, 4] # [height margin, width margin]
)

# %%
font_names = [
    'DWNSPSTR.TTF',
    'majallab.ttf',
    'ariali.ttf',
    'FRADMCN.TTF',
    'msuighub.ttf',
    'GILBI___.TTF',
    'ANTQUABI.TTF',
    'PTBLDMRR.TTF',
    'calibrili.ttf',
    'segoeuisl.ttf',
    'ntailub.ttf',
    'BELL.TTF',
    'cambriaz.ttf',
    'AKHBR.TTF',
    'phagspab.ttf',
    'malgunbd.ttf',
    'ARLRDBD.TTF',
    'DTNASKH4.TTF',
    'calibri.ttf',
    'FELIXTI.TTF',
    'LFAXI.TTF',
    'ROCCB___.TTF',
    'msuighur.ttf',
    'FORTE.TTF',
    'constan.ttf',
    'POORICH.TTF',
    'ARIALNB.TTF',
    'trebucit.ttf',
    'CASTELAR.TTF',
    'TCM_____.TTF',
    'COLONNA.TTF',
    'segoeui.ttf',
    'CALIFI.TTF',
    'msyhl.ttc',
    'BASKVILL.TTF',
    'Candaral.ttf',
    'OLDOUTSH.TTF',
    'HARLOWSI.TTF',
    'PTBLSSTR.TTF',
    'KUNSTLER.TTF',
    'BOD_I.TTF',
    'DUBAI-REGULAR.TTF',
    'consolaz.ttf',
    'segmdl2.ttf',
    'monbaiti.ttf',
    'calibrii.ttf',
    'SCHLBKBI.TTF',
    'trado.ttf',
    'corbeli.ttf',
    'TCBI____.TTF',
    'SPINDSHD.TTF',
    'BRLNSR.TTF',
    'Inkfree.ttf',
    'GIGI.TTF',
    'segoeprb.ttf',
    'times.ttf',
    'MTCORSVA.TTF',
    'FRAHVIT.TTF',
    'timesbd.ttf',
    'TCB_____.TTF',
    'impact.ttf',
    'andlso.ttf',
    'calibrib.ttf',
    'Candara.ttf',
    'ERASLGHT.TTF',
    'BOOKOSI.TTF',
    'ROCKBI.TTF',
    'Candarai.ttf',
    'FRABKIT.TTF',
    'KOUFIBD.TTF',
    'georgiab.ttf',
    'GILB____.TTF',
    'SCHLBKI.TTF',
    'ROCKEB.TTF',
    'Nirmala.ttf',
    'LSANSD.TTF',
    'CENSCBK.TTF',
    'GIL_____.TTF',
    'DUBAI-LIGHT.TTF',
    'timesbi.ttf',
    'FRSCRIPT.TTF',
    'RAVIE.TTF',
    'gadugib.ttf',
    'phagspa.ttf',
    'BOD_B.TTF',
    'ARIALNI.TTF',
    'ANTQUAI.TTF',
    'LTYPE.TTF',
    'ebrima.ttf',
    'palabi.ttf',
    'PARCHM.TTF',
    'FRABK.TTF',
    'LeelawUI.ttf',
    'CascadiaCode.ttf',
    'NirmalaS.ttf',
    'georgiaz.ttf',
    'seguibl.ttf',
    'Candarali.ttf',
    'PERB____.TTF',
    'UrdType.ttf',
    'ROCKI.TTF',
    'BELLB.TTF',
    'DTNASKH3.TTF',
    'palai.ttf',
    'BRLNSB.TTF',
    'courbi.ttf',
    'JOKERMAN.TTF',
    'GILSANUB.TTF',
    'KFEXTOUT.TTF',
    'HARNGTON.TTF',
    'CALIFR.TTF',
    'SitkaVF.ttf',
    'cambriai.ttf',
    'HTOWERT.TTF',
    'OLDANDEC.TTF',
    'GILI____.TTF',
    'LCALLIG.TTF',
    'trebucbi.ttf',
    'webdings.ttf',
    'arial.ttf',
    'LSANSI.TTF',
    'YuGothM.ttc',
    'consolai.ttf',
    'LBRITEI.TTF',
    'ERASDEMI.TTF',
    'PER_____.TTF',
    'seguihis.ttf',
    'LEELAWDB.TTF',
    'ANTQUAB.TTF',
    'HATTEN.TTF',
    'simpbdo.ttf',
    'arialbi.ttf',
    'comicz.ttf',
    'GOUDOSI.TTF',
    'CHILLER.TTF',
    'CALISTBI.TTF',
    'malgun.ttf',
    'COPRGTL.TTF',
    'DWNSH2.TTF',
    'SPBLDJUT.TTF',
    'GARAIT.TTF',
    'SHOWG.TTF',
    'TCCB____.TTF',
    'FRSSPBL.TTF',
    'ERASMD.TTF',
    'BOOKOS.TTF',
    'comicbd.ttf',
    'consola.ttf',
    'trebucbd.ttf',
    'MUDIR.TTF',
    'simsun.ttc',
    'ARIALN.TTF',
    'SPINDOUT.TTF',
    'LBRITE.TTF',
    'IMPRISHA.TTF',
    'LBRITEDI.TTF',
    'PERBI___.TTF',
    'OUTLOOK.TTF',
    'MATURASC.TTF',
    'LFAX.TTF',
    'LTYPEB.TTF',
    'seguisli.ttf',
    'BOD_CBI.TTF',
    'BKANT.TTF',
    'HTOWERTI.TTF',
    'FRAMDCN.TTF',
    'corbelli.ttf',
    'ITCBLKAD.TTF',
    'BOD_CI.TTF',
    'GOTHICI.TTF',
    'YuGothB.ttc',
    'ARIALNBI.TTF',
    'GARABD.TTF',
    'GOTHICB.TTF',
    'BOOKOSB.TTF',
    'CALIFB.TTF',
    'LeelaUIb.ttf',
    'DUBAI-BOLD.TTF',
    'NirmalaB.ttf',
    'CURLZ___.TTF',
    'NIAGSOL.TTF',
    'PTBLDBRK.TTF',
    'aldhabi.ttf',
    'PAPYRUS.TTF',
    'consolab.ttf',
    'simpo.ttf',
    'trebuc.ttf',
    'segoeuib.ttf',
    'courbd.ttf',
    'LSANSDI.TTF',
    'OCRAEXT.TTF',
    'LEDITFNT.TTF',
    'ERASBD.TTF',
    'corbelb.ttf',
    'WINGDNG3.TTF',
    'msjh.ttc',
    'LEELAWAD.TTF',
    'verdanai.ttf',
    'PLAYBILL.TTF',
    'ARABSQ.TTF',
    'MAIAN.TTF',
    'seguibli.ttf',
    'malgunsl.ttf',
    'MTEXTRA.TTF',
    'DWNSPOUT.TTF',
    'DIWANLTR.TTF',
    'AGENCYB.TTF',
    'PTSEPBAL.TTF',
    'FRADM.TTF',
    'majalla.ttf',
    'BOD_BI.TTF',
    'framd.ttf',
    'mvboli.ttf',
    'OLDENGL.TTF',
    'CALISTI.TTF',
    'ntailu.ttf',
    'simsunb.ttf',
    'SPBLDRUL.TTF',
    'FRAHV.TTF',
    'seguili.ttf',
    'mingliub.ttc',
    'msjhbd.ttc',
    'YuGothR.ttc',
    'BRUSHSCI.TTF',
    'palab.ttf',
    'micross.ttf',
    'couri.ttf',
    'VINERITC.TTF',
    'cambria.ttc',
    'JUICE___.TTF',
    'javatext.ttf',
    'GARA.TTF',
    'verdanaz.ttf',
    'arabtype.ttf',
    'VIVALDII.TTF',
    'NIAGENG.TTF',
    'ebrimabd.ttf',
    'ONYX.TTF',
    'SNAP____.TTF',
    'PTBLDHAD.TTF',
    'tradbdo.ttf',
    'simpfxo.ttf',
    'RAGE.TTF',
    'REFSAN.TTF',
    'TCCEB.TTF',
    'seguiemj.ttf',
    'CALISTB.TTF',
    'mmrtext.ttf',
    'georgiai.ttf',
    'VLADIMIR.TTF',
    'ROCC____.TTF',
    'segoeuii.ttf',
    'LeelUIsl.ttf',
    'constanb.ttf',
    'tahoma.ttf',
    'tahomabd.ttf',
    'TCCM____.TTF',
    'timesi.ttf',
    'gadugi.ttf',
    'TEMPSITC.TTF',
    'GLECB.TTF',
    'corbel.ttf',
    'PERTIBD.TTF',
    'DTNASKH0.TTF',
    'constanz.ttf',
    'AGENCYR.TTF',
    'FRSSPOUT.TTF',
    'MAGNETOB.TTF',
    'GLSNECB.TTF',
    'CALIST.TTF',
    'ENGR.TTF',
    'GOUDOS.TTF',
    'mmrtextb.ttf',
    'ELEPHNTI.TTF',
    'GILLUBCD.TTF',
    'YuGothL.ttc',
    'FREESCPT.TTF',
    'segoesc.ttf',
    'pala.ttf',
    'DTHULUTH.TTF',
    'BRITANIC.TTF',
    'SansSerifCollection.ttf',
    'ELEPHNT.TTF',
    'LATINWD.TTF',
    'PERI____.TTF',
    'KFOUTSHD.TTF',
    'BOD_CR.TTF',
    'LBRITED.TTF',
    'corbell.ttf',
    'GOUDYSTO.TTF',
    'Candaraz.ttf',
    'ARBSQDTP.TTF',
    'DWNOUTSH.TTF',
    'calibriz.ttf',
    'REFSPCL.TTF',
    'BOOKOSBI.TTF',
    'PRISTINA.TTF',
    'msjhl.ttc',
    'DUBAI-MEDIUM.TTF',
    'AKHBRBD.TTF',
    'BERNHC.TTF',
    'BOD_BLAI.TTF',
    'COOPBL.TTF',
    'ITLOUTAR.TTF',
    'LFAXDI.TTF',
    'BOD_R.TTF',
    'cambriab.ttf',
    'segoeuiz.ttf',
    'SegoeIcons.ttf',
    'bahnschrift.ttf',
    'BOD_BLAR.TTF',
    'BOD_CB.TTF',
    'verdanab.ttf',
    'l_10646.ttf',
    'corbelz.ttf',
    'CENTURY.TTF',
    'MOD20.TTF',
    'ariblk.ttf',
    'segoepr.ttf',
    'Candarab.ttf',
    'PTBLDARC.TTF',
    'SPOUTPAT.TTF',
    'LTYPEBO.TTF',
    'ROCKB.TTF',
    'FRADMIT.TTF',
    'lucon.ttf',
    'PERTILI.TTF',
    'ALGER.TTF',
    'GOTHICBI.TTF',
    'STENCIL.TTF',
    'Gabriola.ttf',
    'SegUIVar.ttf',
    'PTBLDDSK.TTF',
    'DTNASKH1.TTF',
    'cour.ttf',
    'DIWANBNT.TTF',
    'UrdTypeb.ttf',
    'wingding.ttf',
    'msyhbd.ttc',
    'SCHLBKB.TTF',
    'BAUHS93.TTF',
    'verdana.ttf',
    'framdit.ttf',
    'LTYPEO.TTF',
    'LHANDW.TTF',
    'DTNASKH2.TTF',
    'constani.ttf',
    'BRLNSDB.TTF',
    'GILC____.TTF',
    'WINGDNG2.TTF',
    'BELLI.TTF',
    'msyi.ttf',
    'taileb.ttf',
    'GOTHIC.TTF',
    'holomdl2.ttf',
    'MISTRAL.TTF',
    'TCMI____.TTF',
    'himalaya.ttf',
    'seguisbi.ttf',
    'BRADHITC.TTF',
    'segoeuil.ttf',
    'arialbd.ttf',
    'CENTAUR.TTF',
    'georgia.ttf',
    'SCRIPTBL.TTF',
    'seguisb.ttf',
    'calibril.ttf',
    'msyh.ttc',
    'SitkaVF-Italic.ttf',
    'OLDANOUT.TTF',
    'GOUDOSB.TTF',
    'BROADW.TTF',
    'seguisym.ttf',
    'FTLTLT.TTF',
    'LSANS.TTF',
    'msgothic.ttc',
    'comici.ttf',
    'comic.ttf',
    'LFAXD.TTF',
    'BSSYM7.TTF',
    'COPRGTB.TTF',
    'BOD_PSTC.TTF',
    'ROCK.TTF',
    'OLDANBLD.TTF',
    'ITCEDSCR.TTF',
    'taile.ttf',
    'INFROMAN.TTF',
    'sylfaen.ttf',
    'BLDITLAR.TTF',
    'CascadiaMono.ttf',
    'ITCKRIST.TTF',
    'segoescb.ttf',
    'PALSCRI.TTF',
    'symbol.ttf'
]